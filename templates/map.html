<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wind Energy Predictor - Turbine Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            background-color: rgba(15, 32, 39, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            height: 40px;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, #00b4db, #0083b0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        nav ul {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        nav a {
            color: #e6e6e6;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #00b4db;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .map-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .map-section h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: #00b4db;
            text-align: center;
        }

        #map {
            height: 600px;
            width: 100%;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .turbine-info {
            background: rgba(255, 255, 255, 0.07);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
            display: none;
        }

        .turbine-info.show {
            display: block;
            animation: fadeIn 1s;
        }

        .turbine-info h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #00b4db;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .weather-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .weather-card i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #00b4db;
        }

        .weather-card h4 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .weather-card p {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .energy-output {
            font-size: 2rem;
            font-weight: 700;
            color: #00b4db;
            margin: 1rem 0;
            text-align: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
            background-color: rgba(15, 32, 39, 0.8);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            .map-section {
                padding: 1.5rem;
            }

            #map {
                height: 400px;
            }

            .weather-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-fan" style="font-size: 2rem; color: #00b4db;"></i>
            <div class="logo-text">Wind Energy Predictor</div>
        </div>
        <nav>
            <ul>
                <li><a href="{{ url_for('map_page') }}">Map</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="map-section">
            <h2>Turbine Locations Map</h2>
            <p>Click on any turbine marker to view local weather conditions and predicted energy output.</p>
            
            <div id="map"></div>
            
            <div class="turbine-info" id="turbine-info">
                <h3 id="turbine-name">Turbine Information</h3>
                
                <div class="weather-grid">
                    <div class="weather-card">
                        <i class="fas fa-wind"></i>
                        <h4>Wind Speed</h4>
                        <p id="wind-speed">-- m/s</p>
                    </div>
                    <div class="weather-card">
                        <i class="fas fa-temperature-high"></i>
                        <h4>Temperature</h4>
                        <p id="temperature">--°C</p>
                    </div>
                    <div class="weather-card">
                        <i class="fas fa-tint"></i>
                        <h4>Humidity</h4>
                        <p id="humidity">--%</p>
                    </div>
                    <div class="weather-card">
                        <i class="fas fa-weight-hanging"></i>
                        <h4>Air Density</h4>
                        <p id="air-density">-- kg/m³</p>
                    </div>
                </div>
                
                <div class="energy-output">
                    Predicted Output: <span id="predicted-output">-- MWh</span>
                </div>
                
                <p style="text-align: center; margin-top: 1rem;">
                    Based on current weather conditions and turbine specifications.
                </p>
            </div>
        </div>
    </div>

    <footer>
        <p>© 2023 Wind Energy Predictor | Next-Generation Renewable Energy Management</p>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // OpenWeatherMap API Key (replace with your own key)
        const API_KEY = 'a858f25b862192a043251f3db593498f';
        
        // Initialize map
        const map = L.map('map').setView([20.5937, 78.9629], 5); // Centered on India
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);
        
        // Sample turbine locations (you can add more)
        const turbines = [
            { name: 'Turbine 1 - Gujarat', lat: 23.2156, lng: 72.6369, bladeLength: 40 },
            { name: 'Turbine 2 - Rajasthan', lat: 27.0238, lng: 74.2179, bladeLength: 45 },
            { name: 'Turbine 3 - Karnataka', lat: 15.3173, lng: 75.7139, bladeLength: 38 },
            { name: 'Turbine 4 - Tamil Nadu', lat: 11.1271, lng: 78.6569, bladeLength: 42 },
            { name: 'Turbine 5 - Maharashtra', lat: 19.7515, lng: 75.7139, bladeLength: 40 }
        ];
        
        // Add turbine markers
        turbines.forEach(turbine => {
            const marker = L.marker([turbine.lat, turbine.lng]).addTo(map);
            
            marker.bindPopup(`<b>${turbine.name}</b><br>Click to view details`);
            
            marker.on('click', () => {
                fetchWeatherData(turbine);
            });
        });
        
        // Function to fetch weather data from OpenWeatherMap API
        async function fetchWeatherData(turbine) {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${turbine.lat}&lon=${turbine.lng}&appid=${API_KEY}&units=metric`);
                const data = await response.json();
                
                if (data.cod === 200) {
                    // Update turbine info
                    document.getElementById('turbine-name').textContent = turbine.name;
                    
                    // Weather data
                    const windSpeed = data.wind.speed;
                    const temperature = data.main.temp;
                    const humidity = data.main.humidity;
                    const pressure = data.main.pressure;
                    
                    // Calculate air density (simplified formula)
                    const airDensity = (pressure / (287.05 * (temperature + 273.15))) * 1000;
                    
                    // Update UI
                    document.getElementById('wind-speed').textContent = `${windSpeed} m/s`;
                    document.getElementById('temperature').textContent = `${temperature}°C`;
                    document.getElementById('humidity').textContent = `${humidity}%`;
                    document.getElementById('air-density').textContent = `${airDensity.toFixed(3)} kg/m³`;
                    
                    // Calculate predicted energy output
                    const bladeLength = turbine.bladeLength;
                    const sweptArea = Math.PI * Math.pow(bladeLength, 2);
                    const efficiency = 0.4;
                    const humidityFactor = 1 - (humidity / 200);
                    
                    const power = 0.5 * airDensity * sweptArea * Math.pow(windSpeed, 3) * efficiency * humidityFactor;
                    const energyMWh = (power * 24) / 1000000;
                    
                    document.getElementById('predicted-output').textContent = `${energyMWh.toFixed(2)} MWh`;
                    
                    // Show turbine info
                    document.getElementById('turbine-info').classList.add('show');
                    
                    // Scroll to info section
                    document.getElementById('turbine-info').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Weather data not available for this location.');
                }
            } catch (error) {
                console.error('Error fetching weather data:', error);
                alert('Error fetching weather data. Please check your API key.');
            }
        }
        
        // Instructions for getting API key
        if (API_KEY === 'a858f25b862192a043251f3db593498f') {
            alert('Please replace a858f25b862192a043251f3db593498f with your actual OpenWeatherMap API key.\n\nGet your free API key at: https://openweathermap.org/api');
        }
    </script>
</body>
</html>